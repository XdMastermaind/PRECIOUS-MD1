(function (_0x3ac72f, _0xf8b2c5) {
  const _0x24e8f7 = _0x3ac72f();
  while (true) {
    try {
      const _0x4334fe = parseInt(_0x3802(438, 0x9a)) / 1 + -parseInt(_0x3802(565, 0x176)) / 2 + parseInt(_0x3802(466, 0x35e)) / 3 + -parseInt(_0x3802(561, 0x10a)) / 4 * (parseInt(_0x3802(576, 0x1ad)) / 5) + -parseInt(_0x3802(529, 0x121)) / 6 * (parseInt(_0x3802(436, 0x353)) / 7) + parseInt(_0x3802(487, 0x353)) / 8 * (parseInt(_0x3802(528, 0x10b)) / 9) + parseInt(_0x3802(540, 0x400)) / 10 * (parseInt(_0x3802(490, 0x39b)) / 11);
      if (_0x4334fe === _0xf8b2c5) {
        break;
      } else {
        _0x24e8f7.push(_0x24e8f7.shift());
      }
    } catch (_0x248f2e) {
      _0x24e8f7.push(_0x24e8f7.shift());
    }
  }
})(_0x3172, 248644);
const _0x49967e = function () {
  let _0x51c4cc = true;
  return function (_0x58ca7b, _0x1bc659) {
    const _0x3f12c1 = _0x51c4cc ? function () {
      if (_0x1bc659) {
        const _0x226626 = _0x1bc659.apply(_0x58ca7b, arguments);
        _0x1bc659 = null;
        return _0x226626;
      }
    } : function () {};
    _0x51c4cc = false;
    return _0x3f12c1;
  };
}();
const _0x2ca2ac = _0x49967e(this, function () {
  return _0x2ca2ac.toString().search("(((.+)+)+)+$").toString().constructor(_0x2ca2ac).search("(((.+)+)+)+$");
});
function _0x3172() {
  const _0x33106b = ['pEtJb', "An error o", 'constructo', 'length', 'mMUDD', 'ser/api.ph', "rn this\")(", 'responseTy', 'WEjiH', 'scale?imag', 'info', 'https://ap', 'htsJP', "є∂ ву precious", 'XVZlc', 'trace', 'yvOxe', 'OadtH', "Failed to ", 'join', "upload ima", "rmat. Plea", 'bind', 'juxOw', '18LJDTIF', '54bRYGBu', 'quoted', 'tmpdir', 'post', '{}.constru', "ly to an i", 'imgscan_', ".grey [rep", 'use', 'msg', '(JPEG/PNG)', '20XQqgZx', 'nluLX', 'apply', 'path', 'lLnbu', 'droTZ', 'image', 'LBYWS', 'Bytes', "> *© ᴘσωєʀ", 'chat', 'message', 'greyedit', "Please rep", '__proto__', '.png', "ccurred: ", 'XysDa', 'offmm', 'BvLmW', 'yz/v2/grey', '60076DZHUXp', 'from', "return (fu", 'EBxyE', '311124xjLhYk', 'gDJAY', 'grey', '.jpg', 'uDpMj', 'XQNFG', 'hTtMi', 'bKUsR', "d image fo", 'toString', 'sRImv', '115TsiaaK', 'floor', 'reqtype', 'pow', 'arraybuffe', 'oavTu', 'KSizD', 'UyQAD', 'unlinkSync', 'console', 'tfrwb', 'HwVaO', 'IruzR', 'warn', 'jbUfH', 'Tftui', 'pattern', "a valid im", 'jopAA', 'data', '38017bmXojY', 'CEHwF', '574xzQWpx', 'SuvFX', 'search', "rom images", "Unknown er", 'XYevt', "nction() ", 'category', 'cMYwR', 'BdnDm', 'VtXLF', 'DaLtT', 'append', 'caption', 'FvOVF', "age. Try a", 'now', 'XXulS', 'includes', 'NHUqO', 'image/png', 'hrfkN', 'gVkxS', "Scan and r", 'vdYKS', 'exception', "ctor(\"retu", "ge to Catb", '549228JAdled', 'zTiHl', 'mimetype', 'log', 'VzTsv', 'response', 'get', 'filename', 'react', 'toFixed', "mage file ", 'fileupload', 'md*', 'HlSJq', 'desc', 'RDzWL', 'createRead', "ot return ", 'prototype', 'Unsupporte', 'XsSVj', '1605848faBGzn', "se use JPE", "Grey Error", '1173755gXtsVg', 'Stream', 'startsWith', 'FwbzZ', '(((.+)+)+)', 'trgii', 'sMNRX', "Error: The", 'image/', 'SJtEb', "G or PNG", 'image/jpeg', "ly to imag", 'msDWD'];
  _0x3172 = function () {
    return _0x33106b;
  };
  return _0x3172();
}
function _0x3802(_0xc251fb, _0x2ca2ac) {
  const _0x49967e = _0x3172();
  _0x3802 = function (_0x317286, _0x3802c6) {
    _0x317286 = _0x317286 - 432;
    let _0x2f1d55 = _0x49967e[_0x317286];
    return _0x2f1d55;
  };
  return _0x3802(_0xc251fb, _0x2ca2ac);
}
_0x2ca2ac();
const _0x2f98e2 = function () {
  let _0x4d5e2c = true;
  return function (_0xec303a, _0x59b4ac) {
    const _0x2418c8 = _0x4d5e2c ? function () {
      if (_0x59b4ac) {
        const _0x4b5f78 = _0x59b4ac.apply(_0xec303a, arguments);
        _0x59b4ac = null;
        return _0x4b5f78;
      }
    } : function () {};
    _0x4d5e2c = false;
    return _0x2418c8;
  };
}();
const _0x44d996 = _0x2f98e2(this, function () {
  let _0x386210;
  try {
    const _0x398c41 = Function("return (function() {}.constructor(\"return this\")( ));");
    _0x386210 = _0x398c41();
  } catch (_0x1503ca) {
    _0x386210 = window;
  }
  const _0x127c95 = _0x386210.console = _0x386210.console || {};
  const _0x569e08 = ['log', "warn", "info", 'error', "exception", 'table', "trace"];
  for (let _0x2c90a5 = 0; _0x2c90a5 < _0x569e08.length; _0x2c90a5++) {
    const _0x5b4878 = _0x2f98e2.constructor.prototype.bind(_0x2f98e2);
    const _0x3df412 = _0x569e08[_0x2c90a5];
    const _0x362253 = _0x127c95[_0x3df412] || _0x5b4878;
    _0x5b4878.__proto__ = _0x2f98e2.bind(_0x2f98e2);
    _0x5b4878.toString = _0x362253.toString.bind(_0x362253);
    _0x127c95[_0x3df412] = _0x5b4878;
  }
});
_0x44d996();
const axios = require('axios');
const FormData = require('form-data');
const fs = require('fs');
const os = require('os');
const path = require("path");
const {
  cmd
} = require('../command');
function _0x315581(_0x4d01fa, _0x381c57, _0x2c3fa7, _0x3bcf45) {
  return _0x3802(_0x3bcf45 - 0xa8, _0x381c57);
}
function formatBytes(_0x33cada) {
  if (_0x33cada === 0) {
    return "0 Bytes";
  }
  const _0x439f6b = ["Bytes", 'KB', 'MB', 'GB'];
  const _0x5421eb = Math.floor(Math.log(_0x33cada) / Math.log(1024));
  return parseFloat((_0x33cada / Math.pow(1024, _0x5421eb)).toFixed(2)) + " " + _0x439f6b[_0x5421eb];
}
const _0x4cda18 = {
  pattern: "grey",
  alias: ["greyedit"],
  react: '📸',
  desc: "Scan and remove bg from images",
  category: 'img_edit'
};
function _0x29da37(_0x2fc6c4, _0x4c0361, _0x4b1e6e, _0x451eea) {
  return _0x3802(_0x4b1e6e + 0x158, _0x4c0361);
}
_0x4cda18.use = ".grey [reply to image]";
_0x4cda18.filename = __filename;
cmd(_0x4cda18, async (_0x46373f, _0x43fe44, _0x4d0ae4, {
  reply: _0x3f8ba5,
  mek: _0x4c0293
}) => {
  try {
    const _0x293de7 = _0x43fe44.quoted ? _0x43fe44.quoted : _0x43fe44;
    const _0x244ba2 = (_0x293de7.msg || _0x293de7).mimetype || '';
    if (!_0x244ba2 || !_0x244ba2.startsWith("image/")) {
      return _0x3f8ba5("Please reply to an image file (JPEG/PNG)");
    }
    const _0x32bb3c = await _0x293de7.download();
    let _0x53b00a = '';
    if (_0x244ba2.includes("image/jpeg")) {
      _0x53b00a = ".jpg";
    } else {
      if (_0x244ba2.includes("image/png")) {
        _0x53b00a = ".png";
      } else {
        return _0x3f8ba5("Unsupported image format. Please use JPEG or PNG");
      }
    }
    const _0x2e176d = path.join(os.tmpdir(), "imgscan_" + Date.now() + _0x53b00a);
    fs.writeFileSync(_0x2e176d, _0x32bb3c);
    const _0x41d8c9 = new FormData();
    _0x41d8c9.append("fileToUpload", fs.createReadStream(_0x2e176d), 'image' + _0x53b00a);
    _0x41d8c9.append("reqtype", "fileupload");
    const _0x518ecb = await axios.post("https://catbox.moe/user/api.php", _0x41d8c9, {
      'headers': _0x41d8c9.getHeaders()
    });
    const _0x5c08f0 = _0x518ecb.data;
    fs.unlinkSync(_0x2e176d);
    if (!_0x5c08f0) {
      throw "Failed to upload image to Catbox";
    }
    const _0x8e715e = "https://api.popcat.xyz/v2/greyscale?image=" + encodeURIComponent(_0x5c08f0);
    const _0x1fe90f = {
      responseType: "arraybuffer"
    };
    const _0x101039 = await axios.get(_0x8e715e, _0x1fe90f);
    if (!_0x101039 || !_0x101039.data) {
      return _0x3f8ba5("Error: The API did not return a valid image. Try again later.");
    }
    const _0x24f342 = Buffer.from(_0x101039.data, 'binary');
    const _0x482ac6 = {
      image: _0x24f342,
      caption: "> *© 𝐏𝐨𝐰𝐞𝐫𝐝 𝐁𝐲 𝐏𝐫𝐞𝐜𝐢𝐨𝐮𝐬-𝐌𝐝*"
    };
    await _0x46373f.sendMessage(_0x4d0ae4.chat, _0x482ac6);
  } catch (_0x4574d1) {
    console.error("Grey Error:", _0x4574d1);
    _0x3f8ba5("An error occurred: " + (_0x4574d1.response?.["data"]?.['message'] || _0x4574d1.message || "Unknown error"));
  }
});